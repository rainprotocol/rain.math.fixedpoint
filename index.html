<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Home</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html" class="active">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="src/FixedPointDecimalArithmeticOpenZeppelin.sol/library.FixedPointDecimalArithmeticOpenZeppelin.html">FixedPointDecimalArithmeticOpenZeppelin</a></li><li class="chapter-item "><a href="src/FixedPointDecimalConstants.sol/constants.FixedPointDecimalConstants.html">FixedPointDecimalConstants</a></li><li class="chapter-item "><a href="src/FixedPointDecimalScale.sol/library.FixedPointDecimalScale.html">FixedPointDecimalScale</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rainprotocol/rain.math.fixedpoint" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rainmathfixedpoint"><a class="header" href="#rainmathfixedpoint">rain.math.fixedpoint</a></h1>
<p>Docs at https://rainprotocol.github.io/rain.math.fixedpoint</p>
<h2 id="goals"><a class="header" href="#goals">Goals</a></h2>
<p>Ideally we'd not need this library as math primitives are probably best handled
in some upstream library.</p>
<p>What we need:</p>
<ul>
<li>18 decimal fixed point math</li>
<li>handle rounding directions explicitly</li>
<li>rescale non-18 decimal fixed point values (e.g. ERC20 token amounts) to/from
18 decimals so that we can do math on them</li>
<li>avoid code bloat in an interpreter due to importing several libs with heavily
overlapping scope</li>
<li>open source license, but not forcing ppl to jump on the GPL crusade</li>
<li>minimal surface area so we can gracefully deprecate this lib if all the above
is provided elsewhere someday</li>
<li>works on simple <code>uint256</code> values</li>
</ul>
<p>Upstream candidates:</p>
<ul>
<li>Open Zeppelin
<ul>
<li>Has implementations that include rounding direction üëç</li>
<li>Audited code due to recent ERC4626 implementation üëç</li>
<li>Only includes math needed by the specs implemented, not general purpose üëé</li>
</ul>
</li>
<li>PRB math
<ul>
<li>General purpose fixed point math üëç</li>
<li>Where the scope overlaps OZ the logic is similar or identical üëç</li>
<li>No ability to specify rounding or to rescale outside 18 decimals üëé</li>
<li>Never audited üëé</li>
</ul>
</li>
<li>Others
<ul>
<li>Either wrong license or issues as pointed out on PRB math repo</li>
</ul>
</li>
</ul>
<p>Since we need math that isn't provided by Open Zeppelin, and we aren't going to
write it ourselves, PRB math seems to be the most reasonable foundation. At the
same time, Open Zeppelin may already be a dependency for other reasons, such as
some token implementation, so including both OZ and PRB in a single contract can
bloat code.</p>
<h2 id="non-goals"><a class="header" href="#non-goals">Non-goals</a></h2>
<p>None of this is supported/needed:</p>
<ul>
<li>Signed math</li>
<li>Non-18 decimal fixed point math (other than rescaling)</li>
<li>One size fits all solution</li>
</ul>
<h2 id="approach"><a class="header" href="#approach">Approach</a></h2>
<ul>
<li>Provide a base repo (this one) that has zero dependencies, to focus on the
logic required to rescale between decimals, that are lib agnostic.</li>
<li>Provide supporting repos to normalise Open Zeppelin and PRB math
<ul>
<li>OZ includes <code>muldiv</code> but doesn't have an opinion on decimals, so caller is
forced to provide &quot;one&quot; at every step and mentally balance multiplication
and division</li>
<li>PRB is opinionated with sane defaults for 18 decimal math but provides no
rounding or rescaling support</li>
</ul>
</li>
</ul>
<p>Downstream consumers are advised to select <em>one</em> of either OZ or PRB to compile
into their contracts, using the relevant supporting libs only, to minimise
dependencies and potential code bloat, or even inconsistent behaviours between
libs.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next" href="src/FixedPointDecimalArithmeticOpenZeppelin.sol/library.FixedPointDecimalArithmeticOpenZeppelin.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next" href="src/FixedPointDecimalArithmeticOpenZeppelin.sol/library.FixedPointDecimalArithmeticOpenZeppelin.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>


    </div>
    </body>
</html>
